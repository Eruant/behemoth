!function e(t,i,s){function n(o,a){if(!i[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return n(i?i:e)},c,c.exports,e,t,i,s)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(e){"use strict";var t=function(e){return e&&e.__esModule?e["default"]:e},i=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=t(e("./settings.json")),r=t(e("./classes/loop")),o=t(e("./classes/layout")),a=t(e("./classes/levels")),u=t(e("./modules/loader")),l=t(e("./modules/render")),c=t(e("./modules/io")),h=function(){function e(){s(this,e);var t=1e3/30;this.layout=new o(n.width,n.height),this.loop=new r(this,t,this.update,this.draw),this.levels=new a,l.setDimentions(n.width,n.height);for(var i=0,c=4;c>i;i++){var h="level"+(i+1);this.levels.load(h)}this.levels.setMap("level4"),this.isLoading=!0,u.onLoaded(this,this.start),this.keyActive=!1,this.loop.start()}return i(e,null,{start:{value:function(){this.isLoading=!1,this.currentLevel=this.levels.maps[this.levels.currentMap],l.clearLoader(this.layout.ctx)},writable:!0,configurable:!0},update:{value:function(){c.isKeyPressed()&&this.keyActive===!1?(this.keyActive=!0,this.levels.triggerGates(this.currentLevel)):c.isKeyPressed()||(this.keyActive=!1),this.isLoading||this.levels.updateMobs()},writable:!0,configurable:!0},draw:{value:function(){this.isLoading?l.drawLoader(this.layout.ctx,u.progress()):(l.drawMap(this.layout.ctx,this.currentLevel),l.drawMobs(this.layout.ctx,this.currentLevel.mobs))},writable:!0,configurable:!0}}),e}(),h=new h},{"./classes/layout":4,"./classes/levels":5,"./classes/loop":6,"./modules/io":10,"./modules/loader":11,"./modules/render":12,"./settings.json":13}],2:[function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function n(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,n,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],o(i))return!1;if(s(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=new Array(n-1),u=1;n>u;u++)a[u-1]=arguments[u];i.apply(this,a)}else if(r(i)){for(n=arguments.length,a=new Array(n-1),u=1;n>u;u++)a[u-1]=arguments[u];for(l=i.slice(),n=l.length,u=0;n>u;u++)l[u].apply(this,a)}return!0},i.prototype.addListener=function(e,t){var n;if(!s(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned){var n;n=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var i,n,o,a;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],o=i.length,n=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(i)){for(a=o;a-->0;)if(i[a]===t||i[a].listener&&i[a].listener===t){n=a;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],s(i))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var i;return i=e._events&&e._events[t]?s(e._events[t])?1:e._events[t].length:0}},{}],3:[function(e,t){function i(e){try{return JSON.parse(e)}catch(t){return t}}function s(e){var t=e.split("?"),i={};if(t.length>1)for(var s=t.pop().split("&"),n=0;n<s.length;n++){var r=s[n].split("="),o=window.unescape(r[0]),a=window.unescape(r[1]);i[o]=a}return i}function n(e){var t="";for(var i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&(t+=(t.length?"&":"?")+i+"="+e[i]);return t}function r(e){var t,r=this;if("string"==typeof e&&(e={url:e}),"object"!=typeof e&&(e={}),r.settings=e,r.request=new window.XMLHttpRequest,r.settings.method=r.settings.method||"get",r.settings.cors&&("withCredentials"in r.request?r.request.withCredentials=!0:"undefined"!=typeof XDomainRequest?r.request=new window.XDomainRequest:r.emit("error",new Error("Cors is not supported by this browser"))),r.settings.cache===!1&&(r.settings.data=r.settings.data||{},r.settings.data._=(new Date).getTime()),"get"===r.settings.method.toLowerCase()&&"object"==typeof r.settings.data){t=s(r.settings.url);for(var o in r.settings.data)r.settings.data.hasOwnProperty(o)&&(t[o]=r.settings.data[o]);r.settings.url=r.settings.url.split("?").shift()+n(t),r.settings.data=null}r.request.addEventListener("progress",function(e){r.emit("progress",e)},!1),r.request.addEventListener("load",function(e){var t=e.target.responseText;if(r.settings.dataType&&"json"===r.settings.dataType.toLowerCase())if(""===t)t=void 0;else if(t=i(t),t instanceof Error)return void r.emit("error",e,t);e.target.status>=400?r.emit("error",e,t):r.emit("success",e,t)},!1),r.request.addEventListener("error",function(e){r.emit("error",e)},!1),r.request.addEventListener("abort",function(e){r.emit("abort",e)},!1),r.request.addEventListener("loadend",function(e){r.emit("complete",e)},!1),r.request.open(r.settings.method||"get",r.settings.url,!0),r.settings.contentType!==!1&&r.request.setRequestHeader("Content-Type",r.settings.contentType||"application/json; charset=utf-8"),r.request.setRequestHeader("X-Requested-With",r.settings.requestedWith||"XMLHttpRequest"),r.settings.auth&&r.request.setRequestHeader("Authorization",r.settings.auth);for(var a in r.settings.headers)r.request.setRequestHeader(a,r.settings.headers[a]);r.settings.processData!==!1&&"json"===r.settings.dataType&&(r.settings.data=JSON.stringify(r.settings.data))}var o=e("events").EventEmitter;r.prototype=Object.create(o.prototype),r.prototype.send=function(){this.request.send(this.settings.data&&this.settings.data)},t.exports=r},{events:2}],4:[function(e,t){"use strict";var i=function(e){return e&&e.__esModule?e["default"]:e},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=i(e("../modules/dom")),r=function o(){var e=void 0===arguments[0]?600:arguments[0],t=void 0===arguments[1]?400:arguments[1];s(this,o);var i=n.createElement("canvas"),r=i.getContext("2d");return i.width=e,i.height=t,n.load(function(){n.add(i,"body")}),{canvas:i,ctx:r}};t.exports=r},{"../modules/dom":9}],5:[function(e,t){"use strict";var i=function(e){return e&&e.__esModule?e["default"]:e},s=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=i(e("./map")),o=i(e("../modules/loader")),a=i(e("./mob")),u=function(){function e(){n(this,e),this.maps={},this.currentMap=null}return s(e,null,{add:{value:function(e){this.maps[e.name]=new r(e),this.maps[e.name].mobs=[];for(var t=0,i=e.mobs.length;i>t;t++){var s=e.mobs[t],n={x:parseInt(s.position.x,10),y:parseInt(s.position.y,10)},o={x:parseInt(s.direction.x,10),y:parseInt(s.direction.y,10)},u=parseInt(s.color);this.maps[e.name].mobs.push(new a(n,o,u))}},writable:!0,configurable:!0},setMap:{value:function(e){this.currentMap=e},writable:!0,configurable:!0},load:{value:function(e){var t=this,i="./data/levels/"+e+".json";o.load(i,function(e,i){if("success"===e){var s=JSON.parse(i);t.add(s)}})},writable:!0,configurable:!0},triggerGates:{value:function(e){for(var t=0,i=e.data.length;i>t;t++)switch(e.data[t]){case"o":e.data[t]="c";break;case"c":e.data[t]="o"}},writable:!0,configurable:!0},updateMobs:{value:function(){for(var e=0,t=this.maps[this.currentMap].mobs.length;t>e;e++)this.updateMob(this.maps[this.currentMap].mobs[e])},writable:!0,configurable:!0},updateMob:{value:function(e){{var t=this.maps[this.currentMap],i=e.getNextPosition(),s=t.getKeyForCoordinates(i),n=t.data[s];e.position}n.match(/[\.o]/)?e.setPosition(i):(e.rotate(),i=e.getNextPosition(),s=t.getKeyForCoordinates(i),n=t.data[s],n.match(/[\.o]/)?e.setPosition(i):(e.rotate(),e.rotate(),i=e.getNextPosition(),s=t.getKeyForCoordinates(i),n=t.data[s],n.match(/[\.o]/)?e.setPosition(i):console.warn("mob stuck")))},writable:!0,configurable:!0}}),e}();t.exports=u},{"../modules/loader":11,"./map":7,"./mob":8}],6:[function(e,t){"use strict";var i=function(e){return e&&e.__esModule?e["default"]:e},s=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=i(e("../modules/dom")),o={},a=function(){function e(){var t=void 0===arguments[0]?this:arguments[0],i=void 0===arguments[1]?1e3/60:arguments[1],s=void 0===arguments[2]?null:arguments[2],r=void 0===arguments[3]?null:arguments[3];n(this,e),o.frameTime=i,o.pause=!0,o.update=s.bind(t),o.draw=r.bind(t)}return s(e,null,{start:{value:function(){o.pause=!1,o.startTime=(new Date).getTime(),o.timeSinceLastUpdate=0,this.tick(0)},writable:!0,configurable:!0},stop:{value:function(){o.pause=!0},writable:!0,configurable:!0},isRunning:{value:function(){return o.pause},writable:!0,configurable:!0},tick:{value:function(e){if(!o.pause){var t=(new Date).getTime()-o.startTime,i=e-t;o.timeSinceLastUpdate+=i,o.timeSinceLastUpdate>o.frameTime&&(null!==o.update&&o.update(),o.timeSinceLastUpdate=0),null!==o.draw&&o.draw(),r.requestAnimationFrame(this.tick,this)}},writable:!0,configurable:!0}}),e}();t.exports=a},{"../modules/dom":9}],7:[function(e,t){"use strict";var i=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(t){s(this,e),this.width=t.width,this.height=t.height,this.data=t.data}return i(e,null,{getCoordinatesForKey:{value:function(e){return{x:0===e?0:Math.floor(e/this.width),y:0===e?0:e%this.width}},writable:!0,configurable:!0},getKeyForCoordinates:{value:function(e){return e.y*this.width+e.x},writable:!0,configurable:!0},isKeyValid:{value:function(e){return e>0&&e<=this.data.length},writable:!0,configurable:!0},isCoordinatesValid:{value:function(e){var t=e.x>=0&&e.x<this.width,i=e.y>=0&&e.y<this.height;return t&&i},writable:!0,configurable:!0}}),e}();t.exports=n},{}],8:[function(e,t){"use strict";var i=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(t,i){var n=void 0===arguments[2]?Math.floor(Math.random(360)):arguments[2];s(this,e),this.length=5,this.minLength=3,this.color=n,this.position={x:t.x||0,y:t.y||0},this.direction={x:i.x||0,y:i.y||0},this.bodyParts=[];for(var r=0,o=this.length-1;o>r;r++)this.addBodyPart()}return i(e,null,{addBodyPart:{value:function(){var e;if(0===this.bodyParts.length)e={x:this.position.x,y:this.position.y};else{var t=this.bodyParts[this.bodyParts.length-1];e={x:t.x,y:t.y}}this.bodyParts.push(e)},writable:!0,configurable:!0},setPosition:{value:function(e){var t={x:this.position.x,y:this.position.y};this.position.x=e.x,this.position.y=e.y,this.updateBodyParts(t)},writable:!0,configurable:!0},setDirection:{value:function(e){if("object"==typeof e)this.direction.x=e.x,this.direction.y=e.y;else if("string"==typeof e){var t=0,i=0;switch(e){case"right":t=1,i=0;break;case"left":t=-1,i=0;break;case"up":t=0,i=-1;break;case"down":t=0,i=1}this.direction.x=t,this.direction.y=i}},writable:!0,configurable:!0},getDirection:{value:function(){var e=void 0===arguments[0]?!1:arguments[0];return e?this.getDirectionAsString():this.direction},writable:!0,configurable:!0},getDirectionAsString:{value:function(){var e;return 1===this.direction.x?e="right":-1===this.direction.x?e="left":1===this.direction.y?e="down":-1===this.direction.y&&(e="up"),e},writable:!0,configurable:!0},rotate:{value:function(){var e=void 0===arguments[0]?!0:arguments[0];if(e)switch(this.getDirection(!0)){case"left":this.setDirection("up");break;case"right":this.setDirection("down");break;case"up":this.setDirection("right");break;case"down":this.setDirection("left")}else this.rotate(),this.rotate(),this.rotate()},writable:!0,configurable:!0},getNextPosition:{value:function(){return{x:this.position.x+this.direction.x,y:this.position.y+this.direction.y}},writable:!0,configurable:!0},updateBodyParts:{value:function(e){for(var t={x:e.x,y:e.y},i=0,s=this.bodyParts.length;s>i;i++){var n=this.bodyParts[i];if(n.x!==t.x||n.y!==t.y){var r={x:this.bodyParts[i].x,y:this.bodyParts[i].y};this.bodyParts[i].x=t.x,this.bodyParts[i].y=t.y,t.x=r.x,t.y=r.y}}},writable:!0,configurable:!0}}),e}();t.exports=n},{}],9:[function(e,t){"use strict";var i=window,s=i.document,n={};n.createElement=function(e){return s.createElement(e)},n.load=function(e){i.onload=e},n.add=function(e,t){s.querySelector(t).appendChild(e)},n.requestAnimationFrame=function(e,t){i.requestAnimationFrame(e.bind(t))},n.eventListener=function(e,t,s,n){t===!0?i.addEventListener(s,n.bind(e),!1):i.removeEventListener(s)},n.setTimeout=function(e,t){i.setTimeout(function(){e()},t)},n.save=function(e,t){i.localStorage.setItem(e,t)},n.load=function(e){return i.localStoreage.getItem(e)},t.exports=n},{}],10:[function(e,t){"use strict";var i=function(e){return e&&e.__esModule?e["default"]:e},s=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=i(e("./dom")),o=function(){function e(){n(this,e),this.bindKeyboard(),this.activeKeys=[]}return s(e,null,{bindKeyboard:{value:function(){r.eventListener(this,!0,"keydown",this.keyPressed),r.eventListener(this,!0,"keyup",this.keyReleased)},writable:!0,configurable:!0},keyPressed:{value:function(e){-1===this.activeKeys.indexOf(e.keyCode)&&this.activeKeys.push(e.keyCode)},writable:!0,configurable:!0},keyReleased:{value:function(e){var t=this.activeKeys.indexOf(e.keyCode);-1!==t&&this.activeKeys.splice(t,1)},writable:!0,configurable:!0},getDirection:{value:function(){var e=-1!==this.activeKeys.indexOf(37)?-1:0,t=-1!==this.activeKeys.indexOf(39)?1:0,i=-1!==this.activeKeys.indexOf(38)?-1:0,s=-1!==this.activeKeys.indexOf(40)?1:0;return{x:e+t,y:i+s}},writable:!0,configurable:!0},isKeyPressed:{value:function(){return this.activeKeys.length>0},writable:!0,configurable:!0}}),e}();t.exports=new o},{"./dom":9}],11:[function(e,t){"use strict";var i=function(e){return e&&e.__esModule?e["default"]:e},s=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=i(e("simple-ajax")),o=(i(e("./dom")),function(){function e(){n(this,e),this.loaded=!1,this.filesLoaded=0,this.filesToLoad=0,this.onLoadedCallback=null}return s(e,null,{progress:{value:function(){return 0===this.filesToLoad?(this.loaded=!0,1):0===this.filesLoaded?0:this.filesLoaded/this.filesToLoad},writable:!0,configurable:!0},load:{value:function(e,t){var i=this;this.loaded=!1,this.filesToLoad++,new r(e).on("success",function(e,i){t("success",i)}).on("error",function(e,i){t("error",i)}).on("complete",function(){i.filesLoaded++,1===i.progress()&&i.onLoadedCallback&&i.onLoadedCallback()}).send()},writable:!0,configurable:!0},onLoaded:{value:function(e,t){this.onLoadedCallback=t.bind(e)},writable:!0,configurable:!0}}),e}());t.exports=new o},{"./dom":9,"simple-ajax":3}],12:[function(e,t){"use strict";var i=function(e,t,i){t&&Object.defineProperties(e,t),i&&Object.defineProperties(e.prototype,i)},s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(){s(this,e),this.scale=[1,1]}return i(e,null,{setDimentions:{value:function(e,t){this.width=e,this.height=t,this.tileSize=2},writable:!0,configurable:!0},setScale:{value:function(e,t){var i=this.width/e,s=this.height/t;this.tileSize=i>s?s:i},writable:!0,configurable:!0},drawLoader:{value:function(e,t){this.clearLoader(e),e.fillStyle="hsl(270, 50%, 60%)",e.strokeStyle="hsl(270, 50%, 60%)",e.save(),e.translate(.5*this.width,.5*this.height),e.strokeRect(-50,-5,100,10),e.fillRect(-50,-5,Math.floor(100*t),10),e.restore()},writable:!0,configurable:!0},clearLoader:{value:function(e){e.save(),e.translate(.5*this.width,.5*this.height),e.clearRect(-51,-6,102,12),e.restore()},writable:!0,configurable:!0},drawMap:{value:function(e,t){this.setScale(t.width,t.height);for(var i=0,s=0,n=0,r=t.data.length;r>n;n++){switch(t.data[n]){case"X":e.fillStyle="hsl(100, 50%, 60%)";break;case"c":e.fillStyle="hsl(30, 50%, 80%)";break;case"o":e.fillStyle="hsl(30, 50%, 60%)";break;default:e.fillStyle="hsl(30, 50%, 60%)"}e.fillRect(i,s,this.tileSize-1,this.tileSize-1),n%t.width===t.width-1?(i=0,s+=this.tileSize):i+=this.tileSize}},writable:!0,configurable:!0},drawMobs:{value:function(e,t){this.setScale(map.width,map.height);for(var i=.7*this.tileSize,s=.5*(this.tileSize-i),n=0,r=t.length;r>n;n++){var o=t[n];e.save(),e.translate(o.position.x*this.tileSize,o.position.y*this.tileSize),e.fillStyle="hsl("+o.color+", 50%, 60%)",e.fillRect(s,s,i,i),e.restore();for(var a=0,u=o.bodyParts.length;u>a;a++){var l=o.bodyParts[a];e.save(),e.translate(l.x*this.tileSize,l.y*this.tileSize),e.fillStyle=a+1===u?"hsl("+(o.color+40)+", 50%, 60%)":"hsl("+(o.color+20)+", 50%, 60%)",e.fillRect(s,s,i,i),e.restore()}}},writable:!0,configurable:!0}}),e}();t.exports=new n},{}],13:[function(e,t){t.exports={width:"600",height:"400",mobs:[{name:"mob-1",color:"200"},{name:"mob-2",color:"100"}]}},{}]},{},[1]);
//# sourceMappingURL=bundle.js.map